/*!
 * Тема оформления Experience v.1.0  для Alto CMS
 * @licence     CC Attribution-ShareAlike
 */

/*!
 * ch-datepicker.js
 * Файл скриптов плагина Charming
 *
 * @author      Андрей Г. Воронов <andreyv@gladcode.ru>
 * @copyrights  Copyright © 2013-2014, Андрей Г. Воронов
 *              Copyright © 2012 ExactTarget Licensed under the MIT license.
 *              Является частью плагина Charming
 * @version     0.0.1 от 19.01.14 13:57
 */
(function(b){var c=false;
var a=function(e,d){this.$element=b(e);this.options=b.extend({},b.fn.chFormDatePicker.defaultOptions,d);this.formatDate=(Boolean(this.options.createInput)&&Boolean(this.options.createInput["native"]))?this.formatNativeDate:this.options.formatDate||this.formatDate;
this.parseDate=this.options.parseDate||this.parseDate;this.blackoutDates=this.options.blackoutDates||this.blackoutDates;if(this._checkForMomentJS()){c=window.moment;
this.moment=true;this.momentFormat=this.options.momentConfig.formatCode;this.setCulture(this.options.momentConfig.culture)}if(this.options.date!==null){this.date=this.options.date||new Date();
this.date=this.parseDate(this.date,false);this.viewDate=new Date(this.date.valueOf());this.stagedDate=new Date(this.date.valueOf())}else{this.date=null;
this.viewDate=new Date();this.stagedDate=new Date()}this.inputParsingTarget=null;this.viewDate.setHours(0,0,0,0);this.stagedDate.setHours(0,0,0,0);this.done=false;
this.minDate=new Date();this.minDate.setDate(this.minDate.getDate()-1);this.minDate.setHours(0,0,0,0);this.maxDate=new Date();this.maxDate.setFullYear(this.maxDate.getFullYear()+10);
this.maxDate.setHours(23,59,59,999);this.years=this._yearRange(this.viewDate);this.bindingsAdded=false;this.options.dropdownWidth=this.options.dropdownWidth||170;
this.options.monthNames=this.options.monthNames||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.options.weekdays=this.options.weekdays||["Su","Mo","Tu","We","Th","Fr","Sa"];
this.options.showYears=false;this.options.showDays=true;this.options.showMonths=false;this.options.restrictLastMonth=Boolean(this.options.restrictDateSelection);
this.options.restrictNextMonth=false;this.months=[{abbreviation:this.options.monthNames[0],"class":"",number:0},{abbreviation:this.options.monthNames[1],"class":"",number:1},{abbreviation:this.options.monthNames[2],"class":"",number:2},{abbreviation:this.options.monthNames[3],"class":"",number:3},{abbreviation:this.options.monthNames[4],"class":"",number:4},{abbreviation:this.options.monthNames[5],"class":"",number:5},{abbreviation:this.options.monthNames[6],"class":"",number:6},{abbreviation:this.options.monthNames[7],"class":"",number:7},{abbreviation:this.options.monthNames[8],"class":"",number:8},{abbreviation:this.options.monthNames[9],"class":"",number:9},{abbreviation:this.options.monthNames[10],"class":"",number:10},{abbreviation:this.options.monthNames[11],"class":"",number:11}];
if(Boolean(this.options.createInput)){if(typeof this.options.createInput==="boolean"&&Boolean(this.options.createInput)){this.options.createInput={}}if(typeof this.options.createInput==="object"&&isNaN(this.options.createInput.length)){this.options.createInput.inputSize=this.options.createInput.inputSize||"span3";
this._renderInput()}else{throw new Error("createInput option needs to be an object or boolean true")}}else{this._render()}return this.element};a.prototype={constructor:a,disable:function(){this.$element.find("input, button").attr("disabled",true)
},enable:function(){this.$element.find("input, button").attr("disabled",false)},getFormattedDate:function(){return this.formatDate(this.date)},getDate:function(d){if(Boolean(d)&&Boolean(d.unix)){return this.date.getTime()
}else{return this.date}},setDate:function(d){this.date=this.parseDate(d,false);this.stagedDate=this.date;this.viewDate=this.date;this._render();this.$element.trigger("changed",this.date);
this.$element.find("input").val(this.padTwo(d.getDate())+"."+this.padTwo(d.getMonth()+1)+"."+d.getFullYear());return this.date},getCulture:function(){if(Boolean(this.moment)){return c.lang()
}else{throw"moment.js is not available so you cannot use this function"}},setCulture:function(d){if(!Boolean(d)){return false}if(Boolean(this.moment)){c.lang(d)
}else{throw"moment.js is not available so you cannot use this function"}return true},getFormatCode:function(){if(Boolean(this.moment)){return this.momentFormat
}else{throw"moment.js is not available so you cannot use this function"}},setFormatCode:function(d){if(!Boolean(d)){return false}if(Boolean(this.moment)){this.momentFormat=d
}else{throw"moment.js is not available so you cannot use this function"}return true},formatDate:function(d){if(Boolean(this.moment)){return c(d).format(this.momentFormat)
}else{return this.padTwo(d.getMonth()+1)+"-"+this.padTwo(d.getDate())+"-"+d.getFullYear()}},formatNativeDate:function(d){return d.getFullYear()+"-"+this.padTwo(d.getMonth()+1)+"-"+this.padTwo(d.getDate())
},parseDate:function(e,d){if(this.moment){d=d||false;if(d){return c(e)._d.toString()!=="Invalid Date"}else{return c(e)._d}}else{var g,f,i,h;if(Boolean(e)&&new Date(e).toString()!=="Invalid Date"){if(typeof(e)==="string"){e=e.split("T")[0];
f=/^\s*(\d{4})-(\d\d)-(\d\d)\s*$/;g=new Date(NaN);h=f.exec(e);if(h){i=+h[2];g.setFullYear(h[1],i-1,h[3]);if(i!==g.getMonth()+1){g.setTime(NaN)}}return g
}return new Date(e)}else{throw new Error("could not parse date")}}},blackoutDates:function(d){d=d;return false},padTwo:function(e){var d="0"+e;return d.substr(d.length-2)
},_setNullDate:function(d){this.date=null;this.viewDate=new Date();this.stagedDate=new Date();this._insertDateIntoInput(d||"");this._renderWithoutInputManipulation()
},_restrictDateSelectionSetup:function(){var e,d;if(Boolean(this.options)){if(!this.options.restrictDateSelection){e=false;d=false}else{d=(this.viewDate.getMonth()<new Date().getMonth())?true:false;
e=(this.viewDate.getMonth()>new Date().getMonth())?false:true}}this.options.restrictLastMonth=e;this.options.restrictNextMonth=d},_processDateRestriction:function(d,g){var f="";
var e=false;g=g||false;if(d<=this.minDate||d>=this.maxDate){if(Boolean(this.blackoutDates(d))){f+=" restrict blackout";e=true}else{if(Boolean(this.options)&&Boolean(this.options.restrictDateSelection)){f+=" restrict";
e=true}else{f+=" past"}}}else{if(Boolean(this.blackoutDates(d))){f+=" restrict blackout";e=true}}if(Boolean(g)){return f}else{return e}},_repeat:function(f,k,h,d){var j=f;
for(var e=0,g=k.length;e<g;e++){j+=h(k[e])}j+=d;return j},_getDaysInMonth:function(e,d){return 32-new Date(d,e,32).getDate()},_range:function(g,e){var d=[];
for(var f=g;f<e;f++){d[d.length]=f}return d},_yearRange:function(g){var l=(Math.floor(g.getFullYear()/10)*10)-1;var d=l+12;var j=this._range(l,d);var e=[];
for(var h=0,k=j.length;h<k;h++){var f="";if(h===0){f="previous"}if(h===j.length-1){f="next"}e[h]={number:j[h],"class":f}}return e},_killEvent:function(d){d.stopPropagation();
d.preventDefault();return false},_applySize:function(f,e){for(var d=0;d<f.length;d++){b(f[d]).css({width:e,height:e,"line-height":e})}},_show:function(d){return d?"":"display: none;"
},_hide:function(d){return this._show(!d)},_showView:function(d){if(d===1){this.options.showDays=true;this.options.showMonths=false;this.options.showYears=false
}else{if(d===2){this.options.showDays=false;this.options.showMonths=true;this.options.showYears=false}else{if(d===3){this.options.showDays=false;this.options.showMonths=false;
this.options.showYears=true}}}},_updateCalendarData:function(){var p=this.viewDate.getMonth();var k=this.viewDate.getFullYear();var I=this.stagedDate.getDate();
var d=this.stagedDate.getMonth();var o=this.stagedDate.getFullYear();var n=new Date(k,p,1).getDay();var N=this._getDaysInMonth(p,k);var v=this._getDaysInMonth(p-1,k);
if(n===0){n=7}var e=(42-N)-n;this.daysOfLastMonth=this._range(v-n+1,v+1);this.daysOfNextMonth=this._range(1,e+1);for(var D=0,u=this.daysOfLastMonth.length;
D<u;D++){var P={};P.number=this.daysOfLastMonth[D];P["class"]="";P["class"]=this._processDateRestriction(new Date(k,p+1,this.daysOfLastMonth[D],0,0,0,0),true);
this.daysOfLastMonth[D]=P}for(var O=0,S=this.daysOfNextMonth.length;O<S;O++){var Q={};Q.number=this.daysOfNextMonth[O];Q["class"]="";Q["class"]=this._processDateRestriction(new Date(k,p+1,this.daysOfNextMonth[O],0,0,0,0),true);
this.daysOfNextMonth[O]=Q}var G=new Date();var r=G.getDate();var t=G.getMonth();var l=G.getFullYear();var R=p===t;var F=k===l;var s=p===d;var E=k===o;var A=this._range(1,N+1);
this.daysOfThisMonth=[];for(var K=0,w=A.length;K<w;K++){var M=new Date(k,p,A[K]).getDay();var H="weekday";if(M===6||M===0){H="weekend"}if(M===1){H=""}H+=" weekday"+M;
if(A[K]===I&&s&&E){H+=" selected"}else{if(A[K]===r&&R&&F){H+=" today"}}var h=new Date(k,p,A[K],0,0,0,0);H+=this._processDateRestriction(h,true);this.daysOfThisMonth[this.daysOfThisMonth.length]={number:A[K],"class":H}
}var g=this._getDaysInMonth(this.minDate.getFullYear(),this.minDate.getMonth());for(var J=0,m=this.months.length;J<m;J++){this.months[J]["class"]="";if(F&&J===t){this.months[J]["class"]+=" today"
}if(J===d&&E){this.months[J]["class"]+=" selected"}var f=new Date(k,J,g,23,59,59,999);var y=new Date(k,J,0,0,0,0,0);if(f<=this.minDate||y>=this.maxDate){if(Boolean(this.options.restrictDateSelection)){this.months[J]["class"]+=" restrict"
}}}this.years=this._yearRange(this.viewDate);g=this._getDaysInMonth(this.minDate.getFullYear(),11);for(var C=0,L=this.years.length;C<L;C++){if(this.years[C].number===l){this.years[C]["class"]+=" today"
}if(this.years[C].number===o){this.years[C]["class"]+=" selected"}var q=new Date(this.years[C].number,11,g,23,59,59,999);var B=new Date(this.years[C].number,0,0,0,0,0,0);
if(q<=this.minDate||B>=this.maxDate){if(Boolean(this.options.restrictDateSelection)){this.years[C]["class"]+=" restrict"}}}},_updateCss:function(){while(this.options.dropdownWidth%7!==0){this.options.dropdownWidth++
}this.$view.css("width",this.options.dropdownWidth+"px");this.$header.css("width",this.options.dropdownWidth+"px");this.$labelDiv.css("width",(this.options.dropdownWidth-60)+"px");
this.$footer.css("width",this.options.dropdownWidth+"px");var d=(this.options.dropdownWidth*0.25)-0;var f=Math.round((this.options.dropdownWidth-(d*3))/2);
var g=f;while(g+f+(d*3)<this.options.dropdownWidth){g+=0.1}while(g+f+(d*3)>this.options.dropdownWidth){g-=0.1}f=parseInt(f/2,10);g=parseInt(g/2,10);this.$calendar.css({"float":"left"});
this.$monthsView.css({width:this.options.dropdownWidth+"px","padding-top":f+"px","padding-bottom":g+"px"});this.$yearsView.css({width:this.options.dropdownWidth+"px","padding-top":f+"px","padding-bottom":g+"px"});
var h=Math.round(this.options.dropdownWidth/7)-0+"px";var e=Math.round(this.options.dropdownWidth/7)+"px";this._applySize(this.$yearsView.children(),d+"px");
this._applySize(this.$monthsView.children(),d+"px");this._applySize(this.$weekdaysDiv.children(),e);this._applySize(this.$lastMonthDiv.children(),h);this._applySize(this.$thisMonthDiv.children(),h);
this._applySize(this.$nextMonthDiv.children(),h)},_close:function(){this.$element.find(".input-group").removeClass("open")},_select:function(d){this.inputParsingTarget=null;
if(d.target.className.indexOf("restrict")>-1){return this._killEvent(d)}else{this._killEvent(d);this._close()}this.stagedDate=this.viewDate;this.stagedDate.setDate(parseInt(d.target.innerHTML,10));
this.setDate(this.stagedDate);this._render();this.done=true},_pickYear:function(f){var d=parseInt(b(f.target).data("yearNumber"),10);if(f.target.className.indexOf("restrict")>-1){return this._killEvent(f)
}this.viewDate=new Date(d,this.viewDate.getMonth(),1);this._showView(2);this._render();return this._killEvent(f)},_pickMonth:function(f){var d=parseInt(b(f.target).data("monthNumber"),10);
if(f.target.className.indexOf("restrict")>-1){return this._killEvent(f)}this.viewDate=new Date(this.viewDate.getFullYear(),d,1);this._showView(1);this._render();
return this._killEvent(f)},_previousSet:function(d){this._previous(d,true)},_previous:function(d,f){if(d.target.className.indexOf("restrict")>-1){return this._killEvent(d)
}if(this.options.showDays){this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1)}else{if(this.options.showMonths){this.viewDate=new Date(this.viewDate.getFullYear()-1,this.viewDate.getMonth(),1)
}else{if(this.options.showYears){this.viewDate=new Date(this.viewDate.getFullYear()-10,this.viewDate.getMonth(),1)}}}if(Boolean(f)){this._select(d)}else{this._render()
}return this._killEvent(d)},_nextSet:function(d){this._next(d,true)},_next:function(d,f){if(d.target.className.indexOf("restrict")>-1){return this._killEvent(d)
}if(this.options.showDays){this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1)}else{if(this.options.showMonths){this.viewDate=new Date(this.viewDate.getFullYear()+1,this.viewDate.getMonth(),1)
}else{if(this.options.showYears){this.viewDate=new Date(this.viewDate.getFullYear()+10,this.viewDate.getMonth(),1)}}}if(Boolean(f)){this._select(d)}else{this._render()
}return this._killEvent(d)},_today:function(d){this.viewDate=new Date();this._showView(1);this._render();return this._killEvent(d)},_emptySpace:function(d){if(Boolean(this.done)){this.done=false
}return this._killEvent(d)},_monthLabel:function(){return this.options.fullMonthNames[this.viewDate.getMonth()]},_yearLabel:function(){return this.viewDate.getFullYear()
},_monthYearLabel:function(){var d;if(this.options.showDays){d=this._monthLabel()+" "+this._yearLabel()}else{if(this.options.showMonths){d=this._yearLabel()
}else{if(this.options.showYears){d=this.years[0].number+" - "+this.years[this.years.length-1].number}}}return d},_toggleMonthYearPicker:function(d){if(this.options.showDays){this._showView(2)
}else{if(this.options.showMonths){this._showView(3)}else{if(this.options.showYears){this._showView(1)}}}this._render();return this._killEvent(d)},_renderCalendar:function(){var d=this;
d._restrictDateSelectionSetup();return'<div class="calendar"><div class="header clearfix"><div class="left hover"><div class="leftArrow"></div></div><div class="right hover"><div class="rightArrow"></div></div><div class="center hover">'+d._monthYearLabel()+'</div></div><div class="daysView" style="'+d._show(d.options.showDays)+'">'+d._repeat('<div class="weekdays">',d.options.weekdays,function(e){return"<div >"+e+"</div>"
},"</div>")+d._repeat('<div class="lastmonth">',d.daysOfLastMonth,function(e){if(d.options.restrictLastMonth){e["class"]=e["class"].replace("restrict","")+" restrict"
}return'<div class="'+e["class"]+'">'+e.number+"</div>"},"</div>")+d._repeat('<div class="thismonth">',d.daysOfThisMonth,function(e){return'<div class="'+e["class"]+'">'+e.number+"</div>"
},"</div>")+d._repeat('<div class="nextmonth">',d.daysOfNextMonth,function(e){if(d.options.restrictNextMonth){e["class"]=e["class"].replace("restrict","")+" restrict"
}return'<div class="'+e["class"]+'">'+e.number+"</div>"},"</div>")+"</div>"+d._repeat('<div class="monthsView" style="'+d._show(d.options.showMonths)+'">',d.months,function(e){return'<div data-month-number="'+e.number+'" class="'+e["class"]+'">'+e.abbreviation+"</div>"
},"</div>")+d._repeat('<div class="yearsView" style="'+d._show(d.options.showYears)+'">',d.years,function(e){return'<div data-year-number="'+e.number+'" class="'+e["class"]+'">'+e.number+"</div>"
},"</div>")+'<div class="footer"><div class="center hover">Сегодня</div></div></div>'},_render:function(){this._insertDateIntoInput();this._updateCalendarData();
if(Boolean(this.bindingsAdded)){this._removeBindings()}this.$element.find(".dropdown-menu").html(this._renderCalendar());this._initializeCalendarElements();
this._addBindings();this._updateCss()},_renderWithoutInputManipulation:function(){this._updateCalendarData();if(Boolean(this.bindingsAdded)){this._removeBindings()
}this.$element.find(".dropdown-menu").html(this._renderCalendar());this._initializeCalendarElements();this._addBindings();this._updateCss()},_renderInput:function(){var d=(Boolean(this.options.createInput["native"]))?this._renderInputNative():this._renderInputHTML();
this.$element.html(d);this._render()},_renderInputNative:function(){return'<input type="date" value="'+this.formatDate(this.date)+'"'+this._calculateInputSize(["native"])+">"
},_renderInputHTML:function(){var d=(Boolean(this.options.createInput.dropDownBtn))?"input-append":"input-group";var e='<div class="'+d+'"><div class="dropdown-menu"></div><input type="text" '+this._calculateInputSize()+' value="'+this.formatDate(this.date)+'" data-toggle="dropdown">';
if(Boolean(this.options.createInput.dropDownBtn)){e=e+'<button type="button" class="btn" data-toggle="dropdown"><i class="icon-calendar"></i></button>'
}e=e+"</div>";return'<div class="datepicker dropdown">'+e+"</div>"},_calculateInputSize:function(d){if(Boolean(parseInt(this.options.createInput.inputSize,10))){return'style="width:'+this.options.createInput.inputSize+'px"'
}else{d=(Boolean(d))?" "+d.join(" "):"";return'class="'+this.options.createInput.inputSize+d+'"'}},_insertDateIntoInput:function(e){var d;if(Boolean(e)){d=this.formatDate(this.stagedDate)
}else{if(this.date!==null){d=this.formatDate(this.date)}else{d=""}}this.$element.find('input[type="hidden"]').prev().text(d)},_inputDateParsing:function(){var d=this.$input.val();
var f=true;var e=10;var g=e-2;if(d.length>=g&&d.length<=e){if(Boolean(this.parseDate(d,true))){if(!this._processDateRestriction(this.parseDate(d))){f=false;
this.setDate(d)}}}else{f=false}if(!!f){this._setNullDate(true);this.$element.trigger("inputParsingFailed")}},_checkForMomentJS:function(){if(b.isFunction(window.moment)||(typeof c!=="undefined"&&b.isFunction(c))){if(b.isPlainObject(this.options.momentConfig)){if(Boolean(this.options.momentConfig.culture)&&Boolean(this.options.momentConfig.formatCode)){return true
}else{return false}}else{return false}}else{return false}},_initializeCalendarElements:function(){this.$input=this.$element.find('input[type="text"]');
this.$calendar=this.$element.find("div.calendar");this.$header=this.$calendar.children().eq(0);this.$labelDiv=this.$header.children().eq(2);this.$view=this.$calendar.children().eq(1);
this.$monthsView=this.$calendar.children().eq(2);this.$yearsView=this.$calendar.children().eq(3);this.$weekdaysDiv=this.$view.children().eq(0);this.$lastMonthDiv=this.$view.children().eq(1);
this.$thisMonthDiv=this.$view.children().eq(2);this.$nextMonthDiv=this.$view.children().eq(3);this.$footer=this.$calendar.children().eq(4)},_addBindings:function(){var d=this;
if(Boolean(this.moment)){this.$calendar.on("mouseover",function(){d.inputParsingTarget="calendar"});this.$calendar.on("mouseout",function(){d.inputParsingTarget=null
});this.$input.on("blur",function(){if(d.inputParsingTarget===null){d._inputDateParsing()}})}this.$calendar.on("click",b.proxy(this._emptySpace,this));
this.$header.find(".left").on("click",b.proxy(this._previous,this));this.$header.find(".right").on("click",b.proxy(this._next,this));this.$header.find(".center").on("click",b.proxy(this._toggleMonthYearPicker,this));
this.$lastMonthDiv.find("div").on("click",b.proxy(this._previousSet,this));this.$thisMonthDiv.find("div").on("click",b.proxy(this._select,this));this.$nextMonthDiv.find("div").on("click",b.proxy(this._nextSet,this));
this.$monthsView.find("div").on("click",b.proxy(this._pickMonth,this));this.$yearsView.find("div").on("click",b.proxy(this._pickYear,this));this.$footer.find(".center").on("click",b.proxy(this._today,this));
this.bindingsAdded=true},_removeBindings:function(){if(Boolean(this.moment)){this.$calendar.off("mouseover");this.$calendar.off("mouseout");this.$input.off("blur")
}this.$calendar.off("click");this.$header.find(".left").off("click");this.$header.find(".right").off("click");this.$header.find(".center").off("click");
this.$lastMonthDiv.find("div").off("click");this.$thisMonthDiv.find("div").off("click");this.$nextMonthDiv.find("div").off("click");this.$monthsView.find("div").off("click");
this.$yearsView.find("div").off("click");this.$footer.find(".center").off("click");this.bindingsAdded=false}};b.fn.chFormDatePicker=function(f){var e=Array.prototype.slice.call(arguments,1);
var g;var d=this.each(function(){var j=b(this);var i=j.data("ch.chFormDatePicker");var h=typeof f==="object"&&f;if(!i){j.data("ch.chFormDatePicker",(i=new a(this,h)))
}if(typeof f==="string"){g=i[f].apply(i,e)}});return(g===undefined)?d:g};b.fn.chFormDatePicker.Constructor=a;b.fn.chFormDatePicker.defaultOptions={date:new Date(),momentConfig:{culture:"ru",formatCode:"LL"},monthNames:["Янв","Фев","Март","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],fullMonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],createInput:false,dropdownWidth:170,restrictDateSelection:false}
}(window.jQuery));$(function(){$(".charming-datepicker").chFormDatePicker({})});